# ğŸ”· DIAGRAMA DE OBJETOS - PREXCOL

**Proyecto**: PREXCOL  
**Fecha**: 2025-12-04  
**Tipo**: Diagrama Estructural - Instancias Concretas

---

## ğŸ“‹ ÃNDICE

1. [Escenario: Pedido en Proceso](#escenario-pedido-en-proceso)
2. [Escenario: Sistema de Stock](#escenario-sistema-de-stock)
3. [Escenario: Usuario y Permisos](#escenario-usuario-y-permisos)
4. [Escenario: Pago Completado](#escenario-pago-completado)

---

## ğŸ›’ ESCENARIO: PEDIDO EN PROCESO

### DescripciÃ³n
Estado del sistema cuando un cliente (MarÃ­a GarcÃ­a) tiene un pedido en estado "preparando" con dos productos.

### Diagrama de Objetos

```mermaid
graph TB
    subgraph "Instancias en Runtime - Pedido #1234"
        usuario1[""ğŸ‘¤ usuario1: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 42<br/>email: 'maria@email.com'<br/>nombre: 'MarÃ­a GarcÃ­a'<br/>rol: 'cliente'<br/>estado: true""]
        
        tienda1[""ğŸª tienda1: Tienda<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1<br/>id_administrador: 1<br/>nombre: 'Tienda Centro'<br/>direccion: 'Calle 10 #5-20'<br/>activa: true""]
        
        pedido1[""ğŸ“¦ pedido1: Pedido<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1234<br/>id_cliente: 42<br/>id_tienda: 1<br/>estado: 'preparando'<br/>total: 45000.00<br/>fecha_creacion: '2025-12-04 10:30'<br/>notas: 'Entregar antes 5pm'""]
        
        detalle1[""ğŸ“‹ detalle1: DetallePedido<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 5001<br/>id_pedido: 1234<br/>id_producto: 101<br/>cantidad: 2<br/>precio_unitario: 12000.00<br/>subtotal: 24000.00""]
        
        detalle2[""ğŸ“‹ detalle2: DetallePedido<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 5002<br/>id_pedido: 1234<br/>id_producto: 205<br/>cantidad: 3<br/>precio_unitario: 7000.00<br/>subtotal: 21000.00""]
        
        producto1[""ğŸ“¦ producto1: Producto<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 101<br/>id_tienda: 1<br/>id_proveedor: 15<br/>nombre: 'Arroz Diana 500g'<br/>precio: 12000.00<br/>stock: 148<br/>categoria: 'alimentos'""]
        
        producto2[""ğŸ“¦ producto2: Producto<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 205<br/>id_tienda: 1<br/>id_proveedor: 15<br/>nombre: 'Aceite Girasol 1L'<br/>precio: 7000.00<br/>stock: 67<br/>categoria: 'alimentos'""]
        
        proveedor1[""ğŸ‘¨â€ğŸ’¼ proveedor1: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 15<br/>email: 'juan@proveedora.com'<br/>nombre: 'Juan PÃ©rez'<br/>rol: 'proveedor'<br/>estado: true""]
        
        pago1[""ğŸ’³ pago1: Pago<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 789<br/>id_usuario: 42<br/>id_pedido: 1234<br/>id_estado_pago: 2<br/>id_metodo_pago: 1<br/>monto: 45000.00<br/>fecha_creacion: '2025-12-04 10:25'""]
        
        metodo1[""ğŸ’° metodo1: MetodoPago<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1<br/>nombre: 'Tarjeta CrÃ©dito'<br/>activo: true""]
        
        estado1[""âœ… estado1: EstadoPago<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 2<br/>nombre: 'Aprobado'""]
    end
    
    pedido1 -->|id_cliente = 42| usuario1
    pedido1 -->|id_tienda = 1| tienda1
    pedido1 -->|detalles| detalle1
    pedido1 -->|detalles| detalle2
    pedido1 -->|pagos| pago1
    
    detalle1 -->|id_producto = 101| producto1
    detalle2 -->|id_producto = 205| producto2
    
    producto1 -->|id_tienda = 1| tienda1
    producto2 -->|id_tienda = 1| tienda1
    producto1 -->|id_proveedor = 15| proveedor1
    producto2 -->|id_proveedor = 15| proveedor1
    
    pago1 -->|id_usuario = 42| usuario1
    pago1 -->|id_pedido = 1234| pedido1
    pago1 -->|id_metodo_pago = 1| metodo1
    pago1 -->|id_estado_pago = 2| estado1
```

### Valores Computados

```python
# En el diagrama:
pedido1.total = detalle1.subtotal + detalle2.subtotal
             = 24000.00 + 21000.00
             = 45000.00 âœ“

detalle1.subtotal = detalle1.cantidad * detalle1.precio_unitario
                  = 2 * 12000.00
                  = 24000.00 âœ“

detalle2.subtotal = detalle2.cantidad * detalle2.precio_unitario
                  = 3 * 7000.00
                  = 21000.00 âœ“

# Stock despuÃ©s de pedido:
producto1.stock_inicial = 150
producto1.stock_actual = 148  (vendidas 2 unidades)

producto2.stock_inicial = 70
producto2.stock_actual = 67   (vendidas 3 unidades)
```

---

## ğŸ“Š ESCENARIO: SISTEMA DE STOCK

### DescripciÃ³n
ConfiguraciÃ³n de recarga automÃ¡tica para un producto con stock bajo.

### Diagrama de Objetos

```mermaid
graph TB
    subgraph "Sistema de Stock - Producto con Alerta"
        producto_leche[""ğŸ“¦ producto_leche: Producto<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 301<br/>nombre: 'Leche Entera 1L'<br/>precio: 4500.00<br/>stock: 8 ğŸ”´<br/>es_basico: true<br/>activo: true""]
        
        config_leche[""âš™ï¸ config_leche: StockConfig<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 45<br/>stock_minimo: 10<br/>cantidad_recarga: 50<br/>recarga_automatica_activa: true<br/>ultima_recarga: '2025-12-03 08:00'<br/>total_recargas: 12""]
        
        historial1[""ğŸ“ historial1: HistorialRecarga<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 890<br/>cantidad: 50<br/>stock_anterior: 3<br/>stock_nuevo: 53<br/>tipo: 'automatica'<br/>fecha_creacion: '2025-12-03 08:00'""]
        
        historial2[""ğŸ“ historial2: HistorialRecarga<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 891<br/>cantidad: 10<br/>stock_anterior: 53<br/>stock_nuevo: 63<br/>tipo: 'manual'<br/>fecha_creacion: '2025-12-03 14:30'""]
        
        proveedor_lacteos[""ğŸ‘¨â€ğŸ’¼ proveedor_lacteos: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 18<br/>email: 'ana@lacteos.com'<br/>nombre: 'Ana RodrÃ­guez'<br/>rol: 'proveedor'""]
        
        notif1[""ğŸ“§ notif1: Notificacion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 2345<br/>mensaje: 'Stock bajo: Leche...'<br/>leida: true<br/>fecha_lectura: '2025-12-03 08:05'""]
        
        tipo_notif[""ğŸ”” tipo_notif: TipoNotificacion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 3<br/>nombre: 'Stock Bajo'""]
    end
    
    producto_leche -->|config_stock| config_leche
    producto_leche -->|historial_recargas| historial1
    producto_leche -->|historial_recargas| historial2
    producto_leche -->|proveedor| proveedor_lacteos
    
    historial1 -->|producto| producto_leche
    historial2 -->|producto| producto_leche
    historial2 -->|usuario| proveedor_lacteos
    
    notif1 -->|usuario| proveedor_lacteos
    notif1 -->|tipo| tipo_notif
```

### Estado del Sistema

```python
# CondiciÃ³n: stock <= stock_minimo
producto_leche.stock = 8
config_leche.stock_minimo = 10
# â†’ 8 <= 10 â†’ TRUE â†’ Sistema dispara alerta

# PrÃ³xima acciÃ³n automÃ¡tica:
config_leche.necesita_recarga() = True
# â†’ Celery ejecutarÃ¡ recarga automÃ¡tica

# DespuÃ©s de recarga:
nuevo_stock = producto_leche.stock + config_leche.cantidad_recarga
           = 8 + 50
           = 58

# Historial de movimientos:
historial1: automatica, +50 (3 â†’ 53)
historial2: manual, +10 (53 â†’ 63)
# Stock vendido desde Ãºltima recarga manual: 63 - 8 = 55 unidades
```

---

## ğŸ‘¤ ESCENARIO: USUARIO Y PERMISOS

### DescripciÃ³n
Usuario administrador con historial de contraseÃ±as y tiendas administradas.

### Diagrama de Objetos

```mermaid
graph TB
    subgraph "Usuario Admin con Context"
        admin1[""ğŸ‘¨â€ğŸ’¼ admin1: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1<br/>email: 'admin@prexcol.com'<br/>nombre: 'Carlos Admin'<br/>rol: 'admin'<br/>is_staff: true<br/>is_superuser: true<br/>self_deactivated: false<br/>admin_suspended: false<br/>ultimo_ingreso: '2025-12-04 13:00'""]
        
        pass_hist1[""ğŸ” pass_hist1: PasswordHistory<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 101<br/>password_hash: 'pbkdf2_sha256$...'<br/>fecha_creacion: '2025-10-01'""]
        
        pass_hist2[""ğŸ” pass_hist2: PasswordHistory<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 102<br/>password_hash: 'pbkdf2_sha256$...'<br/>fecha_creacion: '2025-11-15'""]
        
        pass_hist3[""ğŸ” pass_hist3: PasswordHistory<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 103<br/>password_hash: 'pbkdf2_sha256$...'<br/>fecha_creacion: '2025-12-01'<br/>(actual)""]
        
        tienda_centro[""ğŸª tienda_centro: Tienda<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1<br/>nombre: 'Tienda Centro'<br/>activa: true""]
        
        tienda_norte[""ğŸª tienda_norte: Tienda<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 2<br/>nombre: 'Tienda Norte'<br/>activa: true""]
        
        tienda_sur[""ğŸª tienda_sur: Tienda<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 3<br/>nombre: 'Tienda Sur'<br/>activa: false""]
    end
    
    admin1 -->|password_history| pass_hist1
    admin1 -->|password_history| pass_hist2
    admin1 -->|password_history| pass_hist3
    admin1 -->|tiendas_administradas| tienda_centro
    admin1 -->|tiendas_administradas| tienda_norte
    admin1 -->|tiendas_administradas| tienda_sur
    
    tienda_centro -->|administrador| admin1
    tienda_norte -->|administrador| admin1
    tienda_sur -->|administrador| admin1
```

### Reglas de ValidaciÃ³n

```python
# Al cambiar contraseÃ±a, se valida:
nueva_password = "NuevaPass123@"

for history in admin1.password_history.all():
    if check_password(nueva_password, history.password_hash):
        raise ValueError("ContraseÃ±a ya utilizada")

# Historial mantenido:
pass_hist1: hace 2 meses
pass_hist2: hace 19 dÃ­as
pass_hist3: hace 3 dÃ­as (actual)

# Permisos del admin:
admin1.is_superuser = True
# â†’ Puede:
#   - Gestionar todas las tiendas
#   - Suspender/reactivar usuarios
#   - Acceder a todos los reportes
#   - Configurar sistema
```

---

## ğŸ’³ ESCENARIO: PAGO COMPLETADO

### DescripciÃ³n
Flujo completo de un pago aprobado con transacciÃ³n del gateway.

### Diagrama de Objetos

```mermaid
graph TB
    subgraph "Pago Exitoso con TransacciÃ³n"
        cliente2[""ğŸ‘¤ cliente2: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 55<br/>email: 'pedro@email.com'<br/>nombre: 'Pedro LÃ³pez'<br/>rol: 'cliente'""]
        
        pedido2[""ğŸ“¦ pedido2: Pedido<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1235<br/>estado: 'pendiente'<br/>total: 87500.00""]
        
        pago2[""ğŸ’³ pago2: Pago<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 790<br/>monto: 87500.00<br/>fecha_creacion: '2025-12-04 11:15'<br/>fecha_actualizacion: '2025-12-04 11:16'""]
        
        transaccion1[""ğŸ”„ transaccion1: Transaccion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 4567<br/>referencia_externa: 'TRX-PAY-789456'<br/>monto: 87500.00<br/>estado: 'approved'<br/>respuesta_gateway: {'...'}""]
        
        metodo_tarjeta[""ğŸ’° metodo_tarjeta: MetodoPago<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1<br/>nombre: 'Tarjeta CrÃ©dito'<br/>activo: true""]
        
        estado_aprobado[""âœ… estado_aprobado: EstadoPago<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 2<br/>nombre: 'Aprobado'<br/>descripcion: 'Pago autorizado'""]
        
        venta1[""ğŸ’° venta1: Venta<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 456<br/>total: 87500.00<br/>cantidad_items: 4<br/>fecha_venta: '2025-12-04 16:30'""]
    end
    
    pago2 -->|usuario| cliente2
    pago2 -->|pedido| pedido2
    pago2 -->|metodo_pago| metodo_tarjeta
    pago2 -->|estado| estado_aprobado
    pago2 -->|transacciones| transaccion1
    
    pedido2 -->|cliente| cliente2
    pedido2 -->|venta_registrada| venta1
    
    venta1 -->|pedido| pedido2
    venta1 -->|cliente| cliente2
    
    transaccion1 -->|pago| pago2
```

### LÃ­nea de Tiempo

```
11:15:00 - pago2 creado (estado: pendiente)
11:15:05 - transaccion1 enviada a gateway
11:15:23 - Gateway responde: approved
11:15:24 - pago2 actualizado (estado: aprobado)
11:15:25 - pedido2 cambia a estado: pendiente
16:30:00 - pedido2 cambia a estado: entregado
16:30:01 - venta1 generada
```

### Respuesta del Gateway

```json
// transaccion1.respuesta_gateway
{
  "status": "approved",
  "transaction_id": "TRX-PAY-789456",
  "authorization_code": "123456",
  "payment_method": "VISA_CREDIT",
  "last_4_digits": "4532",
  "amount": 87500.00,
  "currency": "COP",
  "processor": "PayU",
  "timestamp": "2025-12-04T11:15:23Z"
}
```

---

## ğŸ”„ ESCENARIO: CICLO DE VIDA DE NOTIFICACIÃ“N

### DescripciÃ³n
NotificaciÃ³n enviada a mÃºltiples usuarios por un evento (pedido creado).

### Diagrama de Objetos

```mermaid
graph TB
    subgraph "Notificaciones por Pedido Creado"
        pedido_evento[""ğŸ“¦ pedido_nuevo: Pedido<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1236<br/>estado: 'pendiente'<br/>fecha_creacion: '2025-12-04 14:00'""]
        
        notif_cliente[""ğŸ“§ notif_cliente: Notificacion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 3001<br/>mensaje: 'Tu pedido #1236 ha sido...'<br/>destino: 'cliente@email.com'<br/>leida: true<br/>fecha_lectura: '2025-12-04 14:05'""]
        
        notif_logistica[""ğŸ“§ notif_logistica: Notificacion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 3002<br/>mensaje: 'Nuevo pedido #1236 para...'<br/>destino: 'logistica@prexcol.com'<br/>leida: false<br/>fecha_lectura: null""]
        
        notif_proveedor[""ğŸ“§ notif_proveedor: Notificacion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 3003<br/>mensaje: 'Pedido #1236 incluye tus...'<br/>destino: 'proveedor@proveedora.com'<br/>leida: true<br/>fecha_lectura: '2025-12-04 14:30'""]
        
        tipo_pedido[""ğŸ”” tipo_pedido: TipoNotificacion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 1<br/>nombre: 'Nuevo Pedido'""]
        
        estado_enviada[""âœ… estado_enviada: EstadoNotificacion<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 2<br/>nombre: 'Enviada'""]
        
        cliente_dest[""ğŸ‘¤ cliente_dest: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 60<br/>rol: 'cliente'""]
        
        logistica_dest[""ğŸ‘¤ logistica_dest: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 8<br/>rol: 'logistica'""]
        
        proveedor_dest[""ğŸ‘¤ proveedor_dest: Usuario<br/>â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br/>id: 15<br/>rol: 'proveedor'""]
    end
    
    notif_cliente -->|usuario| cliente_dest
    notif_cliente -->|tipo| tipo_pedido
    notif_cliente -->|estado| estado_enviada
    
    notif_logistica -->|usuario| logistica_dest
    notif_logistica -->|tipo| tipo_pedido
    notif_logistica -->|estado| estado_enviada
    
    notif_proveedor -->|usuario| proveedor_dest
    notif_proveedor -->|tipo| tipo_pedido
    notif_proveedor -->|estado| estado_enviada
```

---

## ğŸ“Š COMPARACIÃ“N: DIAGRAMA DE CLASES vs OBJETOS

### Diagrama de Clases (Abstracto)

```
Usuario
  - id: Long
  - email: String
  - rol: String
  [0..*] â”€â”€â”€â”€â”€â”€> [1] Pedido
```

### Diagrama de Objetos (Concreto)

```
usuario1: Usuario
  - id: 42
  - email: "maria@email.com"
  - rol: "cliente"
  â”€â”€â”€â”€â”€â”€> pedido1: Pedido
           - id: 1234
           - estado: "preparando"
```

---

## ğŸ¯ CASOS DE USO DE DIAGRAMAS DE OBJETOS

### 1. Debugging
```
Problema: Total de pedido incorrecto
SoluciÃ³n: Crear diagrama de objetos del pedido especÃ­fico
         Ver valores exactos y relaciones activas
```

### 2. Testing
```
Escenario de Prueba: Usuario con 3 intentos fallidos
Diagrama: Muestra objetos concretos de sesiones y errores
```

### 3. DocumentaciÃ³n de Estados
```
Estado del Sistema: Producto con stock crÃ­tico
Diagrama: Instancias reales mostrando alertas y configuraciÃ³n
```

### 4. Ejemplos DidÃ¡cticos
```
EnseÃ±ar a nuevos desarrolladores:
- CÃ³mo se relacionan objetos en runtime
- Valores tÃ­picos de cada campo
- Cardinalidades en acciÃ³n
```

---

## ğŸ“ NOTACIÃ“N Y CONVENCIONES

### Formato de Instancias

```
nombre_variable: TipoClase
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
atributo1: valor1
atributo2: valor2
...
```

### Enlaces

```
objeto1 â”€â”€>|rol| objeto2
```

### Valores Especiales

- `null` - Valor nulo
- `true/false` - Booleanos
- `'texto'` - Strings
- `123` - NÃºmeros
- `[...]` - Colecciones

---

**Documento generado**: 2025-12-04  
**VersiÃ³n**: 1.0  
**Estado**: âœ… Completado
